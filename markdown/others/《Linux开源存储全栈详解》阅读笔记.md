# 《Linux 开源存储全栈详解》阅读笔记

## 前言

* 在脑海里形成它的拓扑，并不断细化。

## Linux 开源存储

* 去除重复数据时，很多需要计算 FingerPrint。
* 原数据如果是基于内存需要启用日志来持久化数据。

## 存储硬件与协议

* IO服务时间包括的：1. 磁头寻道时间。2. 盘片旋转时间。3. 数据传输时间。
* 一般磁头寻道平均时间为 3-15ms。平均旋转时间为3ms。

## Linux 存储栈

* 用户角度读取数据为流的表现形式；存储设备角度为块的表现形式。文件系统则在两者之间。
* /proc/<pid>/maps 可查看映射信息，第1列为内存区域地质，第2列为内存区域大小，第3列为属性，第4列为内存映射文件。
* 与read/write相比，mmap的方式可以减少一次用户空间到内核空间的复制。
* 虚拟文件系统架在系统调用接口和不同的文件系统实现之间，让用户可以使用同一个接口操作不同文件系统。
* Btrfs 的原数据通过 B-Tree 管理。
* Page Cache是以物理页为单位对磁盘文件进行缓存的。通常为4K。
* 对文件缓存的写操作，采用了写时复制，等到要同步或清理缓存时再同步，一般会有延迟。
* 内核以块做为单位，大小一般为512Byte、1KB或4KB。
* 2.4开始，Buffer 不再是个的独立的缓存，包含在Page cache里。
* Direct I/O 传输不经过 Page Cache，减小内核缓冲区和用户空间的数据复制此处，降低对文件读写时所带来的CPU负载能力以及内存带宽的占用率。
* IO请求在经过通用块层之后会进入IO调度层。
* IO调度算法有的 noop、deadline和CFQ。
* 每个进程有自己私有的 Plug（做蓄流）队列的，在这里页会做合并。
* bcache 时内核使用固态硬盘做为缓存，有writeback、writethrough和writeaound。bucket是bcache的关键的结构，通过LRU算法替换。

## 存储加速

* SPDK 是用于与加速 NVMe SSD 作为后端存储使用的应用软件加速哭。核心是用户态、异步、轮询方式的 NVMe驱动。
* 扇区针对磁盘，块针对扇区。

## 存储安全

* MTTR、MTTF、MTBF（Mean Time Between Failure）。
* 在纠删码问题上，对数据分组，恢复也在组内进行。

## 存储管理与软件定义存储

* OpenSDS 为 Linux 下一个子项目，旨在通过软件定义存储参考架构和API标准的全球化推行。
* Libvirt 提供一个软件库来管理节点上的虚拟机。通过管理存储池和卷来为虚拟机提供存储资源。

## 分布式存储与Ceph

* 

## OpenStack存储

* 

## 容器存储

* 